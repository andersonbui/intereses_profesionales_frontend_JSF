<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/principal.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.ListEncuestaTitle}"></h:outputText>
        </ui:define>

        <ui:define name="content">
            <h:outputScript library="js" name="Chart.js"/>
            <h:form id="EstadisticaForm">
                <h:panelGroup id="display">
                    <p:panelGrid columns="2" >

                        <p:outputLabel value="#{bundle.Label_fechaInicio}" for="id_fecha_inicio" />
                        <p:calendar id="id_fecha_inicio" pattern="MM/dd/yyyy" 
                                    navigator="true" 
                                    immediate="true"
                                    value="#{estadisticaController.fechaInicio}" title="#{bundle.Title_fechaInicio}" 
                                    required="true"
                                    requiredMessage="#{bundle.EditEstudianteGradoRequiredMessage_estudianteGradoPK_date}" 
                                    >              
                            <p:ajax event="dateSelect" listener="#{estadisticaController.onDateSelect}" update="id_fecha_fin" />
                        </p:calendar>
                        <p:outputLabel value="#{bundle.Label_fechaFin}" for="id_fecha_fin" />
                        <p:calendar id="id_fecha_fin" widgetVar="idwid_fecha_fin" pattern="MM/dd/yyyy" 
                                    navigator="true" 
                                    mindate="#{estadisticaController.fechaInicio}"
                                    value="#{estadisticaController.fechafin}" 
                                    title="#{bundle.Title_fechaFin}" required="true" 
                                    requiredMessage="#{bundle.EditEstudianteGradoRequiredMessage_estudianteGradoPK_date}" 
                                    >
                            <p:ajax event="dateSelect" listener="#{estadisticaController.reiniciarEstadistica()}" />
                        </p:calendar>

                        <p:outputLabel value="#{bundle.Label_institucion}" for="id_select_institucion" />
                        <p:selectOneMenu id="id_select_institucion" 
                                         value="#{estadisticaController.institucion}" 
                                         required="true"
                                         immediate="true" 
                                         requiredMessage="#{bundle.EditEstudianteGradoRequiredMessage_grado}">

                            <f:selectItem itemLabel="#{bundle.SelectOneMessage}"/>
                            <f:selectItems value="#{institucionController.itemsAvailableSelectOne}"
                                           var="institucion"
                                           itemLabel="#{institucion.nombre}"
                                           itemValue="#{institucion}"/>
                            <f:ajax render="id_select_estudiante" listener="#{estadisticaController.reiniciarEstadistica()}" />
                        </p:selectOneMenu>

                        <p:outputLabel value="#{bundle.Label_grado}" for="id_select_estudiante" />
                        <p:selectOneMenu id="id_select_estudiante" 
                                         value="#{estadisticaController.grado}" 
                                         required="true" 
                                         immediate="true" 
                                         requiredMessage="#{bundle.EditEstudianteGradoRequiredMessage_estudiante}">
                            <f:selectItem itemLabel="#{bundle.SelectOneMessage}"/>
                            <f:selectItems value="#{estadisticaController.institucion.gradoList}"
                                           rendered="#{estadisticaController.institucion!= null}"
                                           var="grado"
                                           itemLabel="#{grado.curso}"
                                           itemValue="#{grado}"/>
                            <f:ajax  listener="#{estadisticaController.reiniciarEstadistica()}" />
                        </p:selectOneMenu>
                    </p:panelGrid>
                    <p:commandButton actionListener="#{estadisticaController.cargarGrafico()}"
                                     value="cargar" 
                                     update="grafica,:growl,display,divgrafico">
                    </p:commandButton>
                    <h:body id='divgrafico'>
                        <p:fragment id="grafica" rendered="#{estadisticaController.getGraficoModelo() != null}">
                            <!--                         
                            <p:chart type="bar" 
                                rendered="{estadisticaController.getGraficoModelo() != null}" 
                                model="{estadisticaController.getGraficoModelo()}" 
                                style="height:250px;  text-align: center; "
                              />-->
                            <!--<p:ajax  event="click" listener="saludar('ansono')" />-->
                            <script>saludar("fragment");
                            graficar(#{estadisticaController.getGraficoModelo()});
                            </script>
                            #{estadisticaController.getGraficoModelo()}
                            <div style="height: 400px; width: 400px;" >
                                <canvas id="myChart" width="400" height="400"></canvas>
                            </div>
                        </p:fragment>
                    </h:body>
                    <!--<p:commandButton value="{bundle.Cancel}" onclick="EstudianteGradoEditDialog.hide()"/>-->
                </h:panelGroup>
            </h:form>
            <script type="text/javascript">
                function graficar(json) {
                    console.log(json);
                    var ctx = document.getElementById("myChart");
                    var myChart = new Chart(ctx, json);
                }
                function saludar(nombre) {
                    console.log('hola ' + nombre);
                }
            </script>
        </ui:define>
    </ui:composition>

</html>
